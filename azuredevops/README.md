# Azure DevOps Webhook Sample

This sample integration showcases triggers for Azure DevOps *pull request created*, *pull request updated* and *build* webhook events.

The preferred approach of using this sample is by applying the `webhook-integration.yaml` as-code template as described
in the main README file.

After applying the YAML file you can test it using the `Test run` feature on the trigger configuration page.

Pull request created events can be tested using `pull_request_created.json`.

Pull request updated events can be tested using `pull_request_updated.json`.

Build events can be tested using `build_completed.json`.

The sample YAML file will configure the following objects in Release under the *Webhook Samples* folder:
 - Single endpoint for all events from Azure DevOps accessible from **http://&lt;xlr-address&gt;/webhooks/azure-devops-sample-webhook**
 - Trigger to handle pull request events
   - This trigger has been configured to use the groovy rule editor which allows for more complex conditions. It checks the event payload 
     to ensure it is only executed when:
        - The pull request is for the xlr-webhooks-samples repository
        - The pull request was created or updated
 - Trigger to handle build events
   - This trigger has been configured to use the groovy rule editor which allows for more complex conditions. It checks the event payload 
	 to ensure it is only executed when:
        - The build has completed
        - The status of the completed build is succeeded, partiallysucceeded, failed or stopped
 - Template that both triggers use to create releases with a number of release variables that will be populated by the
   triggers

## Configure Azure DevOps to send webhook events to Digital.AI Release

In Azure DevOps select project settings and navigate to General > Service hooks.

Select the plus sign to add a new service hook.

Select Web Hooks and click the next button to create the web hook.

Select the type of trigger you would like to create from "Trigger on this type of event", for this example create triggers for
"Build completed", "Pull request created" and "Pull request completed". Select any desired filters and then the click Next.

For the URL use the endpoint created in Release, in this case **http://&lt;xlr-address&gt;/webhooks/azure-devops-sample-webhook**.

Click *Test* if you would like to generate a test web hook that will be delivered to Digital.AI Release.

Then click on *Finish*.  Now the webhook is enabled and should send any of your selected event types to the
endpoint configured in Release.

More information can be found in the [Azure DevOps documentation](https://docs.microsoft.com/en-us/azure/devops/service-hooks/services/webhooks?view=azure-devops).


### Troubleshooting webhooks from Azure DevOps

You can test the webhook that was created in Azure DevOps when configuring a new web hook by clicking the *Test* button. Note this 
option is only available when configuring a new web hook.

In Azure DevOps you can view the history of web hooks that were generated by Azure DevOps. To view the web hook history select project settings 
and navigate to General > Service hooks. Click on the elipsis for a specific web hook and select history. From this screen you can 
view the a summary of the web hook event as well as the request and response for the event.

#### Customizing the YAML file for your environment

The sample here works in a Azure DevOps environment configured with:
 * repository *xlr-webhooks-samples*

Look for this values in the YAML file and adjust according to your environment.


